# 更新日志

本文件记录了海豹骰子AI聊天机器人插件的所有重要更改。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/spec/v2.0.0.html)。

## [2.0.0] - 2024-12-19

### 重大变更 - ⚠️ 破坏性更新
- 🔄 **API重构**: 从OpenAI API迁移到阿里云DashScope API（通义千问）
- 🔧 **配置变更**: `OPENAI_API_KEY` → `DASHSCOPE_API_KEY`
- 🔧 **模型配置**: `OPENAI_MODEL` → `DASHSCOPE_MODEL`

### 新增
- 🧠 **通义千问支持**: 支持qwen-turbo、qwen-plus、qwen-max、qwen-max-longcontext模型
- 📚 **模型选择**: 可根据需求选择不同性能等级的模型
- 🌐 **本土化**: 使用国内API服务，更稳定的网络连接

### 变更
- 📦 **依赖更新**: 替换`openai`为`dashscope`包
- 🔧 **配置系统**: 更新环境变量配置项
- 📖 **文档更新**: 全面更新README和技术文档

### 移除
- ❌ **OpenAI支持**: 不再支持OpenAI官方API
- ❌ **Azure OpenAI**: 不再支持Azure OpenAI服务

### 迁移指南
如果您正在从v1.x版本升级：
1. 修改`.env`文件中的配置项名称
2. 获取DashScope API密钥并配置
3. 选择合适的通义千问模型
4. 更新Python依赖包

## [1.0.0] - 2024-06-13

### 新增
- 🤖 **AI对话功能**: 通过`.chat <消息>`命令与AI大语言模型进行交流
- 💾 **对话历史管理**: 自动维护每个用户和群组的独立对话历史
- 🔄 **历史清除功能**: 支持`.chat clear`命令清除对话历史
- 🏥 **服务状态检查**: 支持`.chat status`命令检查后端服务健康状态
- 📚 **帮助系统**: 支持`.chat help`命令查看使用说明
- 🔧 **灵活配置**: 支持多种OpenAI兼容的API服务
- 🛡️ **错误处理**: 完善的错误处理和重试机制
- 📝 **详细日志**: 前后端完整的请求响应日志记录

### 后端特性
- FastAPI框架构建的RESTful API服务
- 支持OpenAI SDK的所有兼容服务
- 环境变量配置管理
- 对话历史长度限制和自动清理
- CORS支持和安全配置
- 健康检查接口
- 详细的API文档（Swagger UI）

### 前端特性
- 符合海豹骰子v1.4.0+规范的JavaScript插件
- 群组和私聊的对话历史分离
- 智能错误提示和用户友好的反馈
- 请求重试机制
- 消息长度验证

### 技术栈
- **后端**: Python 3.8+, FastAPI, OpenAI SDK, uvicorn
- **前端**: JavaScript (ES6), 海豹骰子插件API
- **部署**: 支持Docker和传统部署方式

### 文档
- 完整的README.md使用说明
- 详细的技术文档
- API接口文档
- 环境配置示例
- 故障排除指南

### 安全特性
- API密钥安全存储（不提交到版本控制）
- 输入验证和消息长度限制
- 请求频率控制
- 详细的错误日志记录

## [未来计划]

### 计划中的功能
- [ ] 用户级别的配置管理
- [ ] 自定义系统提示词
- [ ] 对话历史导出功能
- [ ] 多语言支持
- [ ] 插件热重载支持
- [ ] 更多AI模型支持
- [ ] 对话统计分析
- [ ] 管理员命令集

### 已知问题
- 无已知严重问题

### 技术债务
- 考虑添加数据库支持以持久化对话历史
- 考虑添加缓存机制提升性能
- 考虑添加单元测试

---

## 版本说明

- **主版本号**: 不兼容的API修改
- **次版本号**: 向后兼容的功能性新增
- **修订号**: 向后兼容的问题修正

## 贡献指南

欢迎提交Issue和Pull Request！请确保：
1. 遵循现有的代码风格
2. 添加适当的测试（如果适用）
3. 更新相关文档
4. 在此文件中记录重要更改 